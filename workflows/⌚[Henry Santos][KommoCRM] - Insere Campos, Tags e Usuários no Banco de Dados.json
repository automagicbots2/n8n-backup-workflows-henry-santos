{
  "active": false,
  "connections": {
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "pesquisa_url_base_crm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_url_base_crm": {
      "main": [
        [
          {
            "node": "busca_tags_crm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_users": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "pesquisa_tag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontrou_campo": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "insert_tag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_tags_crm": {
      "main": [
        [
          {
            "node": "separa_users",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_tag": {
      "main": [
        [
          {
            "node": "encontrou_campo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "insert_tag": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_url_base_crm1": {
      "main": [
        [
          {
            "node": "busca_campos_crm1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_users1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Replace Me1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "pesquisa_campos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontrou_campo1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "insert_campo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_campos_crm1": {
      "main": [
        [
          {
            "node": "separa_users1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_campos": {
      "main": [
        [
          {
            "node": "encontrou_campo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "insert_campo": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_colaborador": {
      "main": [
        [
          {
            "node": "encontrou_colaborador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontrou_colaborador": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "insert_colaborador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "insert_colaborador": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "busca_users_crm": {
      "main": [
        [
          {
            "node": "separa_users2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_url_base_crm2": {
      "main": [
        [
          {
            "node": "busca_users_crm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_users2": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [
          {
            "node": "Replace Me2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "pesquisa_colaborador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-01-15T14:54:50.936Z",
  "id": "IsCXHsK84iW9x0h7",
  "meta": null,
  "name": "⌚[Henry Santos][KommoCRM] - Insere Campos, Tags e Usuários no Banco de Dados",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1400,
        -60
      ],
      "id": "990cba14-785a-40d9-b531-5b53c61b5f2f",
      "name": "When clicking ‘Test workflow’"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "URL Base do CRM"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "9ff5f436-c578-4aad-867d-7f4c03d49425",
      "name": "pesquisa_url_base_crm",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -1180,
        -60
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "_embedded.tags",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -740,
        -60
      ],
      "id": "be47f50a-c2a9-40d5-b5ff-d2d71b9a0f99",
      "name": "separa_users"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -520,
        -60
      ],
      "id": "726c3815-a607-4c74-a4d6-f800d9e10f69",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        -300,
        -220
      ],
      "id": "b1deac0a-2ba5-4605-b629-facc67d4da89"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "dd359e72-da78-43bb-84a7-1b0911d82aa5",
              "leftValue": "={{ $node[\"pesquisa_tag\"].json[\"id\"] }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "220433fc-da7b-4a7d-b014-ac361e4e7bb6",
      "name": "encontrou_campo",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.1,
      "position": [
        -100,
        20
      ]
    },
    {
      "parameters": {
        "url": "={{ $node[\"pesquisa_url_base_crm\"].json[\"valor_variavel\"] }}leads/tags",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -960,
        -60
      ],
      "id": "e9cc8399-e8a7-4438-8131-e7800aa2ac12",
      "name": "busca_tags_crm",
      "credentials": {
        "oAuth2Api": {
          "id": "DaKU0ap36aS2tiDi",
          "name": "[Henry Santos] - Kommo ouath 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "tags_crm",
          "mode": "list",
          "cachedResultName": "tags_crm"
        },
        "where": {
          "values": [
            {
              "column": "id_crm",
              "value": "={{ $node[\"Loop Over Items\"].json[\"id\"] }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "7ccfde3a-576c-4dce-8f69-d8fdcfb6025c",
      "name": "pesquisa_tag",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -300,
        20
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "tags_crm",
          "mode": "list",
          "cachedResultName": "tags_crm"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "id_crm",
              "value": "={{ $node[\"Loop Over Items\"].json[\"id\"] }}"
            },
            {
              "column": "nome_tag",
              "value": "={{ $node[\"Loop Over Items\"].json[\"name\"] }}"
            }
          ]
        },
        "options": {
          "replaceEmptyStrings": true,
          "detailedOutput": true
        }
      },
      "id": "c923590d-4993-4f69-91c7-0c5c95bdc5a7",
      "name": "insert_tag",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        160,
        100
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "URL Base do CRM"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "7268300f-6db7-48a2-be7c-a29a2d305485",
      "name": "pesquisa_url_base_crm1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -1180,
        540
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "_embedded.custom_fields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -740,
        540
      ],
      "id": "ed9f4960-28d6-4d01-a58e-29767c4f334a",
      "name": "separa_users1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -520,
        540
      ],
      "id": "2d5bf3c9-d631-46dc-b2a0-c7548c6edb92",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me1",
      "typeVersion": 1,
      "position": [
        -300,
        380
      ],
      "id": "4495e05e-9182-458f-8470-41fb2ec728cb"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "dd359e72-da78-43bb-84a7-1b0911d82aa5",
              "leftValue": "={{ $node[\"pesquisa_campos\"].json[\"id\"] }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "828629d6-f464-4bb6-9840-506a83f4e408",
      "name": "encontrou_campo1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.1,
      "position": [
        -100,
        620
      ]
    },
    {
      "parameters": {
        "url": "={{ $node[\"pesquisa_url_base_crm1\"].json[\"valor_variavel\"] }}leads/custom_fields",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -960,
        540
      ],
      "id": "52aa64e2-b91a-4604-afd3-5c07afd5c59b",
      "name": "busca_campos_crm1",
      "credentials": {
        "oAuth2Api": {
          "id": "DaKU0ap36aS2tiDi",
          "name": "[Henry Santos] - Kommo ouath 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "campos_crm",
          "mode": "list",
          "cachedResultName": "campos_crm"
        },
        "where": {
          "values": [
            {
              "column": "id_campo",
              "value": "={{ $node[\"Loop Over Items1\"].json[\"id\"] }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "1d347f7b-1cc3-48ba-a8b9-53dac6fc4d9d",
      "name": "pesquisa_campos",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -300,
        620
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "campos_crm",
          "mode": "list",
          "cachedResultName": "campos_crm"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "id_campo",
              "value": "={{ $node[\"Loop Over Items1\"].json[\"id\"] }}"
            },
            {
              "column": "chave_campo",
              "value": "={{ $node[\"Loop Over Items1\"].json[\"name\"] }}"
            }
          ]
        },
        "options": {
          "replaceEmptyStrings": true,
          "detailedOutput": true
        }
      },
      "id": "f6720d13-291b-4dcc-8856-7f073b256282",
      "name": "insert_campo",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        160,
        700
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "colaboradores2",
          "mode": "list",
          "cachedResultName": "colaboradores2"
        },
        "where": {
          "values": [
            {
              "column": "email",
              "value": "={{ $node[\"Loop Over Items2\"].json[\"email\"] }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "5c1da09e-dbc3-42c7-af63-91dae362c872",
      "name": "pesquisa_colaborador",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -300,
        1140
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "dd359e72-da78-43bb-84a7-1b0911d82aa5",
              "leftValue": "={{ $node[\"pesquisa_colaborador\"].json[\"id\"] }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "cc9c1e29-f543-4d94-b725-385cc833cfbc",
      "name": "encontrou_colaborador",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.1,
      "position": [
        -100,
        1140
      ]
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "colaboradores2",
          "mode": "list",
          "cachedResultName": "colaboradores2"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "nome",
              "value": "={{ $node[\"Loop Over Items2\"].json[\"name\"] }}"
            },
            {
              "column": "email",
              "value": "={{ $node[\"Loop Over Items2\"].json[\"email\"] }}"
            },
            {
              "column": "id_crm",
              "value": "={{ $node[\"Loop Over Items2\"].json[\"id\"] }}"
            },
            {
              "column": "status_atividade",
              "value": "Y"
            },
            {
              "column": "data_entrada",
              "value": "={{ $now }}"
            }
          ]
        },
        "options": {
          "replaceEmptyStrings": true,
          "detailedOutput": true
        }
      },
      "id": "208c3c65-087f-4f0a-a827-d4c5226fc210",
      "name": "insert_colaborador",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        160,
        1220
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $node[\"pesquisa_url_base_crm2\"].json[\"valor_variavel\"] }}users",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -960,
        1060
      ],
      "id": "92a3105a-229e-47f2-b181-c372f589c7f3",
      "name": "busca_users_crm",
      "credentials": {
        "oAuth2Api": {
          "id": "DaKU0ap36aS2tiDi",
          "name": "[Henry Santos] - Kommo ouath 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "variaveis_globais_n8n",
          "mode": "list",
          "cachedResultName": "variaveis_globais_n8n"
        },
        "where": {
          "values": [
            {
              "column": "nome_variavel",
              "value": "URL Base do CRM"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "id": "dad859b8-26af-4936-b087-92007e5da81b",
      "name": "pesquisa_url_base_crm2",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        -1180,
        1060
      ],
      "alwaysOutputData": true,
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "_embedded.users",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -740,
        1060
      ],
      "id": "c68f68ad-6cf5-4c54-890d-8966318057bf",
      "name": "separa_users2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -520,
        1060
      ],
      "id": "a7da5be1-65e8-4f42-920c-36e38f894163",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me2",
      "typeVersion": 1,
      "position": [
        -300,
        900
      ],
      "id": "da421d2e-f411-4764-a3f8-55168e06c3ae"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "9WrqNFN2jagHPbWV"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-01-15T15:06:01.381Z",
  "versionId": "a014888b-03b5-4b5d-8d9e-0fed66418261"
}