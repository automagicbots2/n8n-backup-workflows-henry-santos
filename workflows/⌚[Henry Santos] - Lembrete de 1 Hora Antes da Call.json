{
  "active": true,
  "connections": {
    "a_cada_hora": {
      "main": [
        [
          {
            "node": "dados_evolution",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_agendamentos_do_dia": {
      "main": [
        [
          {
            "node": "inexistente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_em_linhas": {
      "main": [
        [
          {
            "node": "horarios_formatados",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "fim",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "inexistente": {
      "main": [
        [
          {
            "node": "sem_acao",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "cancelado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cancelado": {
      "main": [
        [
          {
            "node": "sem_acao",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "separa_em_linhas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "esta_na_hora": {
      "main": [
        [
          {
            "node": "pesquisa_lead_via_id",
            "type": "main",
            "index": 0
          },
          {
            "node": "separa_em_linhas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Não faz nada4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "calculadora": {
      "main": [
        [
          {
            "node": "esta_na_hora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "horarios_formatados": {
      "main": [
        [
          {
            "node": "calculadora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "inexistente1": {
      "main": [
        [
          {
            "node": "separa_em_linhas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "item_unico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "item_unico": {
      "main": [
        [
          {
            "node": "EnviaMensagemTexto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_lead_via_id": {
      "main": [
        [
          {
            "node": "inexistente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Listar Campos Personalizados de Contatos da Conta": {
      "main": [
        [
          {
            "node": "Listar Tags da Conta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set": {
      "main": [
        [
          {
            "node": "Listar Campos Personalizados de Contatos da Conta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados_evolution": {
      "main": [
        [
          {
            "node": "pesquisa_agendamentos_do_dia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviaMensagemTexto1": {
      "main": [
        [
          {
            "node": "Retorna Output Aleatorio2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retorna Output Aleatorio2": {
      "main": [
        [
          {
            "node": "Saida Aleatoria2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saida Aleatoria2": {
      "main": [
        [
          {
            "node": "40s2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "45s2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "50s2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "53s2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "40s2": {
      "main": [
        [
          {
            "node": "Não faz nada4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "45s2": {
      "main": [
        [
          {
            "node": "Não faz nada4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "50s2": {
      "main": [
        [
          {
            "node": "Não faz nada4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "53s2": {
      "main": [
        [
          {
            "node": "Não faz nada4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Não faz nada4": {
      "main": [
        [
          {
            "node": "separa_em_linhas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-01-20T22:02:11.170Z",
  "id": "908jYAZTlDx3lj9a",
  "meta": null,
  "name": "⌚[Henry Santos] - Lembrete de 1 Hora Antes da Call",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 6
            },
            {
              "triggerAtHour": 6,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 7
            },
            {
              "triggerAtHour": 7,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 8
            },
            {
              "triggerAtHour": 8,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 9
            },
            {
              "triggerAtHour": 9,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 10
            },
            {
              "triggerAtHour": 10,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 11
            },
            {
              "triggerAtHour": 11,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 12
            },
            {
              "triggerAtHour": 12,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 13
            },
            {
              "triggerAtHour": 13,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 14
            },
            {
              "triggerAtHour": 14,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 15
            },
            {
              "triggerAtHour": 15,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 16
            },
            {
              "triggerAtHour": 16,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 17
            },
            {
              "triggerAtHour": 17,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 18
            },
            {
              "triggerAtHour": 18,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 19
            },
            {
              "triggerAtHour": 19,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 20
            },
            {
              "triggerAtHour": 20,
              "triggerAtMinute": 30
            },
            {
              "triggerAtHour": 21
            },
            {
              "triggerAtHour": 21,
              "triggerAtMinute": 30
            }
          ]
        }
      },
      "id": "77a9166c-c947-43b8-8036-45c2ab03b0ca",
      "name": "a_cada_hora",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [
        40,
        740
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "agendamentos",
          "mode": "list",
          "cachedResultName": "agendamentos"
        },
        "where": {
          "values": [
            {
              "column": "data_de_inicio",
              "value": "={{ $now.toFormat('dd/MM/yyyy').slice(6,10) }}-{{ $now.toFormat('dd/MM/yyyy').slice(3,5) }}-{{ $now.toFormat('dd/MM/yyyy').slice(0,2) }}"
            }
          ]
        },
        "options": {
          "detailedOutput": false
        }
      },
      "id": "aba6b098-84ca-4bab-aa29-e1984462d470",
      "name": "pesquisa_agendamentos_do_dia",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.1,
      "position": [
        440,
        740
      ],
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "e2dc1855-8500-4684-ab70-ac600ad76636",
      "name": "separa_em_linhas",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 2,
      "position": [
        1020,
        780
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "leads",
          "mode": "list",
          "cachedResultName": "leads"
        },
        "where": {
          "values": [
            {
              "column": "id_lead",
              "value": "={{ $node[\"separa_em_linhas\"].json[\"id_lead\"] }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {
          "detailedOutput": false
        }
      },
      "id": "7645f873-66cc-42b3-a497-4ce9476ce6b5",
      "name": "pesquisa_lead_via_id",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.1,
      "position": [
        1840,
        500
      ],
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {},
      "id": "018b7d31-3e44-42ca-bd7e-063c5bcd4c37",
      "name": "fim",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1240,
        880
      ]
    },
    {
      "parameters": {},
      "id": "b756bab5-0b85-4400-aefe-d802b5ca1717",
      "name": "sem_acao",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1020,
        540
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $node[\"pesquisa_agendamentos_do_dia\"].json[\"success\"] }}",
              "operation": "contains",
              "value2": "true"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "731228bf-b8f0-4220-abe1-220916a6c801",
      "name": "inexistente",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        620,
        740
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $node[\"pesquisa_agendamentos_do_dia\"].json[\"status_evento\"] }}",
              "value2": "Cancelado"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "2d44eb3f-9716-4c63-ac53-675c835bccdf",
      "name": "cancelado",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        820,
        760
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $node[\"calculadora\"].json[\"No Intervalo\"].toString() }}",
              "value2": "true"
            }
          ]
        }
      },
      "id": "bd48d273-478b-4581-9a4a-9c58e7d14149",
      "name": "esta_na_hora",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1640,
        680
      ]
    },
    {
      "parameters": {
        "jsCode": "const horaInicio = $node[\"horarios_formatados\"].json[\"HORA INICIO\"];\nconst agora = $node[\"horarios_formatados\"].json[\"AGORA\"];\n\n// Divida a hora de início e a hora atual em horas e minutos\nconst [horaInicioHora, horaInicioMinuto] = horaInicio.split(':').map(Number);\nconst [agoraHora, agoraMinuto] = agora.split(':').map(Number);\n\n// Calcule a diferença em minutos\nconst diferencaMinutos = (agoraHora - horaInicioHora) * 60 + agoraMinuto - horaInicioMinuto;\n\n// Crie um objeto com os resultados\nconst resultado = {\n  \"HORA INICIO\": horaInicio,\n  \"AGORA\": agora,\n  \"Diferença em Minutos\": diferencaMinutos,\n  \"No Intervalo\": diferencaMinutos >= -70 && diferencaMinutos <= -50\n};\n\nreturn resultado;\n"
      },
      "id": "6e9e46e8-732d-454b-8fe3-728c4f34055d",
      "name": "calculadora",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1440,
        680
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "HORA INICIO",
              "value": "={{ $node[\"separa_em_linhas\"].json[\"hora_de_inicio\"].slice(0,5) }}"
            },
            {
              "name": "AGORA",
              "value": "={{ $now.toFormat('HH:mm') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "01582106-d434-44f3-9d13-d4ff8ec69e58",
      "name": "horarios_formatados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        1240,
        680
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $node[\"pesquisa_lead_via_id\"].json[\"success\"] }}",
              "operation": "contains",
              "value2": "true"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "bd5b0d13-771f-4049-9084-d658c2091d1a",
      "name": "inexistente1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        2020,
        500
      ]
    },
    {
      "parameters": {
        "operation": "limit",
        "keep": "lastItems"
      },
      "id": "6951df47-7638-4b80-ad6e-55303f6ac611",
      "name": "item_unico",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        2320,
        560
      ]
    },
    {
      "parameters": {
        "url": "=https://{{ $node[\"Set\"].json[\"url_api_activecampaign\"] }}.api-us1.com/api/3/tags?limit=1000&search={{ $node[\"Set\"].json[\"tag_procurada\"] }}",
        "options": {},
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Api-Token",
              "value": "={{ $node[\"Set\"].json[\"Api-Token\"] }}"
            },
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        }
      },
      "name": "Listar Tags da Conta",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        500,
        160
      ],
      "id": "43adf162-ea82-4515-ba9b-0ba055f5b65d"
    },
    {
      "parameters": {
        "content": "## Para consulta\n \nUtilize os Nodes Abaixo para consultar os IDs dos Campos e Tags no ActiveCampaign",
        "height": 407.6377565498652,
        "width": 747.0856205721786
      },
      "id": "d1fca89a-309a-4d29-b4ba-a86f699ee92d",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "url": "=https://{{ $json[\"url_api_activecampaign\"] }}.api-us1.com/api/3/fields?limit=1000",
        "options": {},
        "headerParametersUi": {
          "parameter": [
            {
              "name": "Api-Token",
              "value": "={{ $node[\"Set\"].json[\"Api-Token\"] }}"
            },
            {
              "name": "content-type",
              "value": "application/json"
            },
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        }
      },
      "name": "Listar Campos Personalizados de Contatos da Conta",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        300,
        160
      ],
      "id": "d5b86c04-6348-49b1-a021-12d46610fea0"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "Api-Token",
              "value": "f855a9327a9219d27bf8713569e0f7e926110f6bbe180b11ad6c3a9bdb922fd7f05402c9"
            },
            {
              "name": "url_api_activecampaign",
              "value": "futureminds14016"
            },
            {
              "name": "tag_procurada",
              "value": "1hora"
            }
          ]
        },
        "options": {}
      },
      "id": "eae055d9-9148-4b79-8ddd-05567cb603c8",
      "name": "Set",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        100,
        160
      ]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "apikey",
              "value": "0EAD0386DBC7-46F1-8414-06CFB9E2E7D4"
            },
            {
              "name": "url_base_evolution",
              "value": "https://apievolution.automagicbots.com.br/"
            },
            {
              "name": "instancia",
              "value": "HenrySantos"
            }
          ]
        },
        "options": {}
      },
      "id": "7196a106-cc99-4412-afab-a37cfd40b285",
      "name": "dados_evolution",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        240,
        740
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"dados_evolution\"].json[\"url_base_evolution\"] }}message/sendText/{{ $node[\"dados_evolution\"].json[\"instancia\"] }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node[\"dados_evolution\"].json[\"apikey\"] }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $node[\"item_unico\"].json[\"telefone\"] }}"
            },
            {
              "name": "text",
              "value": "=Opaa, passando pra lembrar que daqui 1 hora temos a sua sessão estratégica, nossa especialista mandou avisar que está com tudo preparado já 👏"
            },
            {
              "name": "options.delay",
              "value": "={{ 1200 }}"
            },
            {
              "name": "options.presence",
              "value": "composing"
            },
            {
              "name": "options.linkPreview",
              "value": "={{ false }}"
            },
            {
              "name": "=options.mentions.everyOne",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true
            }
          }
        }
      },
      "id": "024f9984-60f3-4e78-b7cb-c5a676726e0a",
      "name": "EnviaMensagemTexto1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2520,
        560
      ],
      "typeVersion": 4
    },
    {
      "parameters": {
        "jsCode": "return {aleatorio: Math.floor(Math.random() * 4)};"
      },
      "id": "7dbce102-fc09-4ff3-8752-321555cc2f60",
      "name": "Retorna Output Aleatorio2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        2700,
        560
      ]
    },
    {
      "parameters": {
        "value1": "={{ $json[\"aleatorio\"] }}",
        "rules": {
          "rules": [
            {
              "operation": "equal"
            },
            {
              "operation": "equal",
              "value2": 1,
              "output": 1
            },
            {
              "operation": "equal",
              "value2": 2,
              "output": 2
            }
          ]
        },
        "fallbackOutput": 3
      },
      "id": "538de858-96d6-4154-9854-b7edb03d7360",
      "name": "Saida Aleatoria2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        2880,
        540
      ]
    },
    {
      "parameters": {
        "amount": 40,
        "unit": "seconds"
      },
      "id": "3ee65855-937b-4419-a682-a11900bc4793",
      "name": "40s2",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        3100,
        500
      ],
      "webhookId": "fcc6aa9e-8b55-40be-a2cd-377ffc4de6e1"
    },
    {
      "parameters": {
        "amount": 45,
        "unit": "seconds"
      },
      "id": "c0cf34f3-5176-4c24-aaca-57a8863f1c10",
      "name": "45s2",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        3100,
        640
      ],
      "webhookId": "9dfde8ed-0087-4622-a22b-ceeeb93ac4bb"
    },
    {
      "parameters": {
        "amount": 50,
        "unit": "seconds"
      },
      "id": "56bd34db-0f8a-4f90-abe7-a8375345f2bf",
      "name": "50s2",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        3100,
        780
      ],
      "webhookId": "6fcfeeda-0304-42a7-968d-a1bad95b1630"
    },
    {
      "parameters": {
        "amount": 53,
        "unit": "seconds"
      },
      "id": "6282b16e-9271-4e21-8845-a2ee5da0f1c3",
      "name": "53s2",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        3100,
        920
      ],
      "webhookId": "351fd17e-9ed0-4c36-829e-e0919c749b69"
    },
    {
      "parameters": {},
      "id": "83b09780-5a50-43c9-a050-258d7a598ebd",
      "name": "Não faz nada4",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3320,
        1020
      ]
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "9WrqNFN2jagHPbWV"
  },
  "staticData": {
    "node:a_cada_hora": {
      "recurrenceRules": []
    }
  },
  "tags": [
    {
      "createdAt": "2024-03-27T14:03:25.264Z",
      "updatedAt": "2024-03-27T14:03:25.264Z",
      "id": "Ju8yPHXMHj0pxd19",
      "name": "[LEMBRETE]"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-01-20T22:03:17.543Z",
  "versionId": "f2c814b5-52ab-4ac7-8f42-3c9649d49813"
}