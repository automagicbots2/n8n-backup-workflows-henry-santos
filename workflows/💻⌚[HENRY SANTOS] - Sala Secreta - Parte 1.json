{
  "active": true,
  "connections": {
    "formata_dados": {
      "main": [
        [
          {
            "node": "pesquisa_colaborador1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados_validados": {
      "main": [
        [
          {
            "node": "entra_na_fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sala_secreta": {
      "main": [
        [
          {
            "node": "formata_dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_colaborador1": {
      "main": [
        [
          {
            "node": "verifica_closer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_vez_closer2": {
      "main": [
        [
          {
            "node": "id_sdr_rodizio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verifica_closer": {
      "main": [
        [
          {
            "node": "atualiza_vez_closer1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "verifica_closer1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_vez_closer1": {
      "main": [
        [
          {
            "node": "id_sdr_rodizio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verifica_closer1": {
      "main": [
        [
          {
            "node": "atualiza_vez_closer2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "id_sdr_rodizio": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "dados_validados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata_dados1": {
      "main": [
        [
          {
            "node": "pesquisa_colaborador",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "id_sdr_rodizio1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pesquisa_colaborador": {
      "main": [
        [
          {
            "node": "verifica_closer2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_vez_closer": {
      "main": [
        [
          {
            "node": "id_sdr_rodizio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verifica_closer2": {
      "main": [
        [
          {
            "node": "atualiza_vez_closer3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "verifica_closer3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_vez_closer3": {
      "main": [
        [
          {
            "node": "id_sdr_rodizio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verifica_closer3": {
      "main": [
        [
          {
            "node": "atualiza_vez_closer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing1": {
      "main": [
        [
          {
            "node": "dados_validados1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sala_secreta_manychat": {
      "main": [
        [
          {
            "node": "formata_dados1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados_validados1": {
      "main": [
        [
          {
            "node": "entra_na_fila1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-02-01T18:53:19.750Z",
  "id": "HUdLjrQwAGhnAS8l",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "üíª‚åö[HENRY SANTOS] - Sala Secreta - Parte 1",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Extrair informa√ß√µes do input\nconst inputData = items[0].json;\nconst respostas = inputData.body;\n\nfunction formatarTelefone1(telefone) {\n  const telefoneLimpo = telefone.replace(/[^\\d]/g, '');\n\n  let ddi;\n  let ddd;\n  let telefoneFormatado;\n\n  // Verificar se o telefone come√ßa com \"55\" antes de format√°-lo\n  if (telefoneLimpo.startsWith('55')) {\n    ddi = telefoneLimpo.slice(0, 2);\n    ddd = telefoneLimpo.slice(2, 4);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  } else {\n    ddi = '55';\n    ddd = telefoneLimpo.slice(0, 2);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  }\n\n  return telefoneFormatado;\n}\n\n// Fun√ß√£o para obter a data atual menos 15 dias no formato brasileiro (dia/m√™s/ano)\nfunction getDataMenos15Dias() {\n  const dataAtual = new Date();\n  dataAtual.setDate(dataAtual.getDate() - 15);\n  const dia = dataAtual.getDate().toString().padStart(2, '0');\n  const mes = (dataAtual.getMonth() + 1).toString().padStart(2, '0'); // +1 porque o m√™s come√ßa em 0\n  const ano = dataAtual.getFullYear();\n  return `${ano}-${mes}-${dia}`;\n}\n\n// UTMS\nconst utmContent = $node[\"sala_secreta\"].json[\"body\"][\"utm_content\"] || '';\nconst utmSource = $node[\"sala_secreta\"].json[\"body\"][\"utm_source\"] || '';\nconst utmCampaign = $node[\"sala_secreta\"].json[\"body\"][\"utm_campaign\"] || '';\nconst utmMedium = $node[\"sala_secreta\"].json[\"body\"][\"utm_medium\"] || '';\nconst utmTerm = $node[\"sala_secreta\"].json[\"body\"][\"utm_term\"] || '';\n\nfunction formatarInstagram(username) {\n  if (username) {\n    // Remover espa√ßos em branco extras\n    let usernameFormatado = username.trim();\n\n    // Remover o s√≠mbolo @ caso exista no in√≠cio\n    if (usernameFormatado.startsWith('@')) {\n      usernameFormatado = usernameFormatado.slice(1);\n    }\n\n    // Converter para min√∫sculas\n    usernameFormatado = usernameFormatado.toLowerCase();\n\n    return usernameFormatado;\n  }\n  return '';\n}\n\n\n// Fun√ß√£o para extrair as UTMs do objeto JSON\nfunction extractUTMs(json) {\n  const utmParams = {};\n\n  function searchUTMs(obj) {\n    for (const key in obj) {\n      if (key.startsWith('utm_')) {\n        utmParams[key] = obj[key];\n      } else if (typeof obj[key] === 'object') {\n        searchUTMs(obj[key]);\n      }\n    }\n  }\n\n  searchUTMs(json);\n\n  return utmParams;\n}\n\n// Extrair as UTMs do objeto JSON de entrada\nconst utms = extractUTMs(inputData);\n\n// Fun√ß√£o para formata√ß√£o de emails\nfunction formatarEmail(email) {\n  // Remover espa√ßos em branco extras\n  const emailSemEspacos = email.trim();\n\n  // Converter para min√∫sculas\n  const emailFormatado = emailSemEspacos.toLowerCase();\n\n  return emailFormatado;\n}\n\n// Fun√ß√£o para formata√ß√£o de nomes\nfunction formatarNome(nome) {\n  if (nome) {\n    const palavras = nome.trim().split(/\\s+/);\n\n    const palavrasMinusculas = ['de', 'dos', 'da', 'e', 'do', 'das', 'di', 'du', 'o', 'a', 'u'];\n\n    for (let i = 0; i < palavras.length; i++) {\n      const palavraAtual = palavras[i].toLowerCase();\n      if (i === 0 || i === palavras.length - 1 || !palavrasMinusculas.includes(palavraAtual)) {\n        palavras[i] = palavraAtual.charAt(0).toUpperCase() + palavraAtual.slice(1);\n      } else {\n        palavras[i] = palavraAtual;\n      }\n    }\n\n    return palavras.join(\" \");\n  }\n  return '';\n}\n\n// Fun√ß√£o para remover todas as aspas e par√™nteses de um texto\nfunction removerAspasEParenteses(texto) {\n    // Substitui todas as ocorr√™ncias de aspas (\"\") por nada\n    let textoSemAspas = texto.replace(/\"/g, '');\n    // Substitui todas as ocorr√™ncias de par√™nteses () por nada\n    textoSemAspas = textoSemAspas.replace(/\\([^()]*\\)/g, '');\n    return textoSemAspas;\n}\n\n\n// Data da aplica√ß√£o em milissefundos\nconst dataAtualEmMilissegundos = new Date().getTime();\n\n// INFORMA√á√ïES PESSOAIS\nconst nome = formatarNome($node[\"sala_secreta\"].json[\"body\"][\"Nome\"]) || \"\";\n\nconst telefone = formatarTelefone1($node[\"sala_secreta\"].json[\"body\"][\"Whatsapp\"]) || '';\n\nconst email = formatarEmail($node[\"sala_secreta\"].json[\"body\"][\"E-mail\"]) || \"\";\n\nconst instagram = formatarInstagram($node[\"sala_secreta\"].json[\"body\"][\"Instagram\"]) || '';\n\n// Montar o objeto de output\nconst output = {\n \"Nome do Cliente\": nome,\n \"E-mail do Cliente\": email,\n \"Telefone do Cliente - Formato BC\": '+' + telefone,\n \"Telefone do Cliente - Formato Z-API\": telefone,\n  instagram,\n  utm_content: utmContent,\n  utm_source: utmSource,\n  utm_campaign: utmCampaign,\n  utm_medium: utmMedium,\n  utm_term: utmTerm,\n  data_ultima_quinzena: getDataMenos15Dias(),\n  data_aplicacao: dataAtualEmMilissegundos\n};\n\nreturn [output];"
      },
      "id": "66a50900-5024-4655-a9c1-ac369f4bab11",
      "name": "formata_dados",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -520,
        300
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "Nome do Cliente",
              "value": "={{ $node[\"formata_dados\"].json[\"Nome do Cliente\"] }}"
            },
            {
              "name": "E-mail do Cliente",
              "value": "={{ $node[\"formata_dados\"].json[\"E-mail do Cliente\"] }}"
            },
            {
              "name": "Telefone do Cliente - Formato BC",
              "value": "={{ $node[\"formata_dados\"].json[\"Telefone do Cliente - Formato BC\"] }}"
            },
            {
              "name": "Telefone do Cliente - Formato Z-API",
              "value": "={{ $node[\"formata_dados\"].json[\"Telefone do Cliente - Formato Z-API\"] }}"
            },
            {
              "name": "Instagram",
              "value": "={{ $node[\"formata_dados\"].json[\"instagram\"] }}"
            },
            {
              "name": "pergunta0",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta0\"] }}"
            },
            {
              "name": "pergunta1",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta1\"] }}"
            },
            {
              "name": "pergunta2",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta2\"] }}"
            },
            {
              "name": "pergunta3",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta3\"] }}"
            },
            {
              "name": "pergunta4",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta4\"] }}"
            },
            {
              "name": "pergunta5",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta5\"] }}"
            },
            {
              "name": "pergunta6",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta6\"] }}"
            },
            {
              "name": "pergunta7",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta7\"] }}"
            },
            {
              "name": "pergunta8",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta8\"] }}"
            },
            {
              "name": "pergunta9",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta9\"] }}"
            },
            {
              "name": "pergunta10",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta10\"] }}"
            },
            {
              "name": "pergunta11",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta11\"] }}"
            },
            {
              "name": "pergunta12",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta12\"] }}"
            },
            {
              "name": "pergunta13",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta13\"] }}"
            },
            {
              "name": "pergunta14",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta14\"] }}"
            },
            {
              "name": "pergunta15",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta15\"] }}"
            },
            {
              "name": "pergunta16",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta16\"] }}"
            },
            {
              "name": "pergunta17",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta17\"] }}"
            },
            {
              "name": "pergunta18",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta18\"] }}"
            },
            {
              "name": "pergunta19",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta19\"] }}"
            },
            {
              "name": "pergunta20",
              "value": "={{ $node[\"formata_dados\"].json[\"pergunta20\"] }}"
            },
            {
              "name": "utm_content",
              "value": "={{ $node[\"formata_dados\"].json[\"utm_content\"] }}"
            },
            {
              "name": "utm_source",
              "value": "={{ $node[\"formata_dados\"].json[\"utm_source\"] }}"
            },
            {
              "name": "utm_campaign",
              "value": "={{ $node[\"formata_dados\"].json[\"utm_campaign\"] }}"
            },
            {
              "name": "utm_medium",
              "value": "={{ $node[\"formata_dados\"].json[\"utm_medium\"] }}"
            },
            {
              "name": "utm_term",
              "value": "={{ $node[\"formata_dados\"].json[\"utm_term\"] }}"
            },
            {
              "name": "funil",
              "value": "sessao estrategica"
            },
            {
              "name": "variacao_do_funil",
              "value": "webnario_semanal"
            },
            {
              "name": "data_resposta_type",
              "value": "={{$now.toFormat('dd/MM/yyyy HH:mm')}}"
            },
            {
              "name": "data_ultima_quinzena",
              "value": "={{ $node[\"formata_dados\"].json[\"data_ultima_quinzena\"] }}"
            },
            {
              "name": "responsible_user_id_crm",
              "value": "={{ $node[\"id_sdr_rodizio\"].json[\"id_sdr\"].replace('Will','11762515').replace('Jean','11918983') }}"
            },
            {
              "name": "status_id_crm",
              "value": "73490559"
            },
            {
              "name": "pipeline_id_crm",
              "value": "9518403"
            },
            {
              "name": "instagram_contato",
              "value": "788726"
            },
            {
              "name": "nome_contato",
              "value": "11743307"
            },
            {
              "name": "telefone_contato",
              "value": "710450"
            },
            {
              "name": "email_contato",
              "value": "710452"
            },
            {
              "name": "utm_source_contato",
              "value": "1015234"
            },
            {
              "name": "utm_campaign_contato",
              "value": "1015236"
            },
            {
              "name": "utm_content_contato",
              "value": "1015238"
            },
            {
              "name": "utm_medium_contato",
              "value": "1015240"
            },
            {
              "name": "utm_term_contato",
              "value": "1015242"
            },
            {
              "name": "utm_fun_contato",
              "value": "1015244"
            },
            {
              "name": "utm_var_contato",
              "value": "1015246"
            },
            {
              "name": "instagram_lead",
              "value": "1018510"
            },
            {
              "name": "utm_source_lead",
              "value": "1018512"
            },
            {
              "name": "utm_campaign_lead",
              "value": "1018514"
            },
            {
              "name": "utm_content_lead",
              "value": "1008412"
            },
            {
              "name": "utm_medium_lead",
              "value": "1018516"
            },
            {
              "name": "utm_term_lead",
              "value": "1018518"
            },
            {
              "name": "utm_fun_lead",
              "value": "1018520"
            },
            {
              "name": "utm_var_lead",
              "value": "1018522"
            },
            {
              "name": "url_base",
              "value": "https://evolutionapi.automagicbots.com.br"
            },
            {
              "name": "apikey",
              "value": "1gozy92fyg3hlty3wkv7f"
            },
            {
              "name": "nome_da_instancia",
              "value": "MSAHenrySantos"
            }
          ]
        },
        "options": {}
      },
      "id": "918e7e1d-0326-4664-9a1c-dd76b17d271c",
      "name": "dados_validados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        840,
        300
      ]
    },
    {
      "parameters": {
        "queue": "Webnario - Parte 2",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "durable": true
        }
      },
      "id": "b379a5fa-845d-4535-8b2f-494930c2e038",
      "name": "entra_na_fila",
      "type": "n8n-nodes-base.rabbitmq",
      "typeVersion": 1,
      "position": [
        1020,
        300
      ],
      "credentials": {
        "rabbitmq": {
          "id": "J2XRJ2ukEbkqQASv",
          "name": "[RabbitMQ] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sala-secreta-captacao",
        "options": {}
      },
      "id": "7c288e8a-6db3-4f10-a045-7af2ae254c30",
      "name": "sala_secreta",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        -720,
        300
      ],
      "webhookId": "a0979ad2-d086-4c27-8eb3-411eca1a59c7"
    },
    {
      "parameters": {
        "url": "=https://veronicaburgel15.kommo.com/api/v4/leads/7987064",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "92c335e9-d15a-4560-b6f9-3cf65004a500",
      "name": "busca_lead_kommo",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        0,
        0
      ],
      "credentials": {
        "oAuth2Api": {
          "id": "iGd90KYctpkhwimG",
          "name": "[KommoCRM] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://veronicaburgel15.kommo.com/api/v4/contacts/9421808",
        "authentication": "genericCredentialType",
        "genericAuthType": "oAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "9295880d-f996-4204-b5a8-1bdcb2e015e9",
      "name": "busca_contato_kommo",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        220,
        0
      ],
      "credentials": {
        "oAuth2Api": {
          "id": "iGd90KYctpkhwimG",
          "name": "[KommoCRM] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "id_sdr",
              "stringValue": "={{ $node[\"pesquisa_colaborador1\"].json[\"id_vez\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "01e003a1-a9a9-4a4c-a8d9-003e727b788f",
      "name": "id_sdr_rodizio",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        460,
        300
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "colaboradores",
          "mode": "list",
          "cachedResultName": "colaboradores"
        },
        "where": {
          "values": [
            {
              "column": "email",
              "value": "vitorrqueiroztrafego@gmail.com"
            }
          ]
        },
        "options": {}
      },
      "id": "77261285-ad83-4695-972f-de04e0302b76",
      "name": "pesquisa_colaborador1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -360,
        300
      ],
      "credentials": {
        "mySql": {
          "id": "rva8krZgONj5RBij",
          "name": "[MySQL] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "colaboradores",
          "mode": "list",
          "cachedResultName": "colaboradores"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "email",
        "valueToMatchOn": "vitorrqueiroztrafego@gmail.com",
        "valuesToSend": {
          "values": [
            {
              "column": "id_vez",
              "value": "Jean"
            }
          ]
        },
        "options": {}
      },
      "id": "5c90fef7-1e82-45fb-b4e1-a2e152d1dd50",
      "name": "atualiza_vez_closer2",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        280,
        460
      ],
      "credentials": {
        "mySql": {
          "id": "rva8krZgONj5RBij",
          "name": "[MySQL] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "552b2396-434c-42b6-99c4-0f6c5de72b7e",
              "leftValue": "={{ $json[\"id_vez\"] }}",
              "rightValue": "Jean",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8a043b89-5d03-4413-9218-c9530ccee904",
      "name": "verifica_closer",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -140,
        300
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "colaboradores",
          "mode": "list",
          "cachedResultName": "colaboradores"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "email",
        "valueToMatchOn": "vitorrqueiroztrafego@gmail.com",
        "valuesToSend": {
          "values": [
            {
              "column": "id_vez",
              "value": "Will"
            }
          ]
        },
        "options": {}
      },
      "id": "a93a0ba7-f194-4f32-9466-f43cf21abe92",
      "name": "atualiza_vez_closer1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        60,
        300
      ],
      "credentials": {
        "mySql": {
          "id": "rva8krZgONj5RBij",
          "name": "[MySQL] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a33d7185-fd20-49b8-b8e4-d6c884085b27",
              "leftValue": "={{ $json[\"id_vez\"] }}",
              "rightValue": "Will",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ac1204f2-8e99-4e97-86d1-2e1514e44687",
      "name": "verifica_closer1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        100,
        460
      ]
    },
    {
      "parameters": {},
      "id": "906d008a-b3df-411a-8dc6-82cbb9536cb6",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        640,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extrair informa√ß√µes do input\nconst inputData = items[0].json;\nconst respostas = inputData.body;\n\nfunction formatarTelefone1(telefone) {\n  const telefoneLimpo = telefone.replace(/[^\\d]/g, '');\n\n  let ddi;\n  let ddd;\n  let telefoneFormatado;\n\n  // Verificar se o telefone come√ßa com \"55\" antes de format√°-lo\n  if (telefoneLimpo.startsWith('55')) {\n    ddi = telefoneLimpo.slice(0, 2);\n    ddd = telefoneLimpo.slice(2, 4);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  } else {\n    ddi = '55';\n    ddd = telefoneLimpo.slice(0, 2);\n    if (parseInt(ddd, 10) > 28) {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-8);\n    } else {\n      telefoneFormatado = ddi + ddd + telefoneLimpo.slice(-9);\n    }\n  }\n\n  return telefoneFormatado;\n}\n\n// Fun√ß√£o para obter a data atual menos 15 dias no formato brasileiro (dia/m√™s/ano)\nfunction getDataMenos15Dias() {\n  const dataAtual = new Date();\n  dataAtual.setDate(dataAtual.getDate() - 15);\n  const dia = dataAtual.getDate().toString().padStart(2, '0');\n  const mes = (dataAtual.getMonth() + 1).toString().padStart(2, '0'); // +1 porque o m√™s come√ßa em 0\n  const ano = dataAtual.getFullYear();\n  return `${ano}-${mes}-${dia}`;\n}\n\n// UTMS\nconst utmContent = $node[\"sala_secreta_manychat\"].json[\"body\"][\"Fluxo\"] || '';\nconst utmSource = $node[\"sala_secreta_manychat\"].json[\"body\"][\"Origem\"] || '';\nconst utmCampaign = $node[\"sala_secreta_manychat\"].json[\"body\"][\"utm_campaign\"] || '';\nconst utmMedium = $node[\"sala_secreta_manychat\"].json[\"body\"][\"utm_medium\"] || '';\nconst utmTerm = $node[\"sala_secreta_manychat\"].json[\"body\"][\"utm_term\"] || '';\n\nfunction formatarInstagram(username) {\n  if (username) {\n    // Remover espa√ßos em branco extras\n    let usernameFormatado = username.trim();\n\n    // Remover o s√≠mbolo @ caso exista no in√≠cio\n    if (usernameFormatado.startsWith('@')) {\n      usernameFormatado = usernameFormatado.slice(1);\n    }\n\n    // Converter para min√∫sculas\n    usernameFormatado = usernameFormatado.toLowerCase();\n\n    return usernameFormatado;\n  }\n  return '';\n}\n\n\n// Fun√ß√£o para extrair as UTMs do objeto JSON\nfunction extractUTMs(json) {\n  const utmParams = {};\n\n  function searchUTMs(obj) {\n    for (const key in obj) {\n      if (key.startsWith('utm_')) {\n        utmParams[key] = obj[key];\n      } else if (typeof obj[key] === 'object') {\n        searchUTMs(obj[key]);\n      }\n    }\n  }\n\n  searchUTMs(json);\n\n  return utmParams;\n}\n\n// Extrair as UTMs do objeto JSON de entrada\nconst utms = extractUTMs(inputData);\n\n// Fun√ß√£o para formata√ß√£o de emails\nfunction formatarEmail(email) {\n  // Remover espa√ßos em branco extras\n  const emailSemEspacos = email.trim();\n\n  // Converter para min√∫sculas\n  const emailFormatado = emailSemEspacos.toLowerCase();\n\n  return emailFormatado;\n}\n\n// Fun√ß√£o para formata√ß√£o de nomes\nfunction formatarNome(nome) {\n  if (nome) {\n    const palavras = nome.trim().split(/\\s+/);\n\n    const palavrasMinusculas = ['de', 'dos', 'da', 'e', 'do', 'das', 'di', 'du', 'o', 'a', 'u'];\n\n    for (let i = 0; i < palavras.length; i++) {\n      const palavraAtual = palavras[i].toLowerCase();\n      if (i === 0 || i === palavras.length - 1 || !palavrasMinusculas.includes(palavraAtual)) {\n        palavras[i] = palavraAtual.charAt(0).toUpperCase() + palavraAtual.slice(1);\n      } else {\n        palavras[i] = palavraAtual;\n      }\n    }\n\n    return palavras.join(\" \");\n  }\n  return '';\n}\n\n// Fun√ß√£o para remover todas as aspas e par√™nteses de um texto\nfunction removerAspasEParenteses(texto) {\n    // Substitui todas as ocorr√™ncias de aspas (\"\") por nada\n    let textoSemAspas = texto.replace(/\"/g, '');\n    // Substitui todas as ocorr√™ncias de par√™nteses () por nada\n    textoSemAspas = textoSemAspas.replace(/\\([^()]*\\)/g, '');\n    return textoSemAspas;\n}\n\n\n// Data da aplica√ß√£o em milissefundos\nconst dataAtualEmMilissegundos = new Date().getTime();\n\n// INFORMA√á√ïES PESSOAIS\nconst nome = formatarNome($node[\"sala_secreta_manychat\"].json[\"body\"][\"Nome\"]) || \"\";\n\nconst telefone = formatarTelefone1($node[\"sala_secreta_manychat\"].json[\"body\"][\"Telefone\"]) || '';\n\n//const email = formatarEmail($node[\"sala_secreta_manychat\"].json[\"body\"][\"E-mail\"]) || \"\";\n\nconst instagram = formatarInstagram($node[\"sala_secreta_manychat\"].json[\"body\"][\"Instagram\"]) || '';\n\n// Montar o objeto de output\nconst output = {\n \"Nome do Cliente\": nome,\n //\"E-mail do Cliente\": email,\n \"Telefone do Cliente - Formato BC\": '+' + telefone,\n \"Telefone do Cliente - Formato Z-API\": telefone,\n  instagram,\n  utm_content: utmContent,\n  utm_source: utmSource,\n  utm_campaign: utmCampaign,\n  utm_medium: utmMedium,\n  utm_term: utmTerm,\n  data_ultima_quinzena: getDataMenos15Dias(),\n  data_aplicacao: dataAtualEmMilissegundos\n};\n\nreturn [output];"
      },
      "id": "fe6d79ec-b7b1-4f25-b8ed-460f1e72465c",
      "name": "formata_dados1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -500,
        620
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "Nome do Cliente",
              "value": "={{ $node[\"formata_dados1\"].json[\"Nome do Cliente\"] }}"
            },
            {
              "name": "E-mail do Cliente",
              "value": "={{ $node[\"formata_dados1\"].json[\"E-mail do Cliente\"] }}"
            },
            {
              "name": "Telefone do Cliente - Formato BC",
              "value": "={{ $node[\"formata_dados1\"].json[\"Telefone do Cliente - Formato BC\"] }}"
            },
            {
              "name": "Telefone do Cliente - Formato Z-API",
              "value": "={{ $node[\"formata_dados1\"].json[\"Telefone do Cliente - Formato Z-API\"] }}"
            },
            {
              "name": "Instagram",
              "value": "={{ $node[\"formata_dados1\"].json[\"instagram\"] }}"
            },
            {
              "name": "pergunta0",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta0\"] }}"
            },
            {
              "name": "pergunta1",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta1\"] }}"
            },
            {
              "name": "pergunta2",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta2\"] }}"
            },
            {
              "name": "pergunta3",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta3\"] }}"
            },
            {
              "name": "pergunta4",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta4\"] }}"
            },
            {
              "name": "pergunta5",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta5\"] }}"
            },
            {
              "name": "pergunta6",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta6\"] }}"
            },
            {
              "name": "pergunta7",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta7\"] }}"
            },
            {
              "name": "pergunta8",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta8\"] }}"
            },
            {
              "name": "pergunta9",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta9\"] }}"
            },
            {
              "name": "pergunta10",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta10\"] }}"
            },
            {
              "name": "pergunta11",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta11\"] }}"
            },
            {
              "name": "pergunta12",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta12\"] }}"
            },
            {
              "name": "pergunta13",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta13\"] }}"
            },
            {
              "name": "pergunta14",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta14\"] }}"
            },
            {
              "name": "pergunta15",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta15\"] }}"
            },
            {
              "name": "pergunta16",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta16\"] }}"
            },
            {
              "name": "pergunta17",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta17\"] }}"
            },
            {
              "name": "pergunta18",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta18\"] }}"
            },
            {
              "name": "pergunta19",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta19\"] }}"
            },
            {
              "name": "pergunta20",
              "value": "={{ $node[\"formata_dados1\"].json[\"pergunta20\"] }}"
            },
            {
              "name": "utm_content",
              "value": "={{ $node[\"formata_dados1\"].json[\"utm_content\"] }}"
            },
            {
              "name": "utm_source",
              "value": "={{ $node[\"formata_dados1\"].json[\"utm_source\"] }}"
            },
            {
              "name": "utm_campaign",
              "value": "={{ $node[\"formata_dados1\"].json[\"utm_campaign\"] }}"
            },
            {
              "name": "utm_medium",
              "value": "={{ $node[\"formata_dados1\"].json[\"utm_medium\"] }}"
            },
            {
              "name": "utm_term",
              "value": "={{ $node[\"formata_dados1\"].json[\"utm_term\"] }}"
            },
            {
              "name": "funil",
              "value": "sessao estrategica"
            },
            {
              "name": "variacao_do_funil",
              "value": "webnario_semanal"
            },
            {
              "name": "data_resposta_type",
              "value": "={{$now.toFormat('dd/MM/yyyy HH:mm')}}"
            },
            {
              "name": "data_ultima_quinzena",
              "value": "={{ $node[\"formata_dados1\"].json[\"data_ultima_quinzena\"] }}"
            },
            {
              "name": "responsible_user_id_crm",
              "value": "={{ $node[\"id_sdr_rodizio1\"].json[\"id_sdr\"].replace('Will','11762515').replace('Jean','11918983') }}"
            },
            {
              "name": "status_id_crm",
              "value": "73490559"
            },
            {
              "name": "pipeline_id_crm",
              "value": "9518403"
            },
            {
              "name": "instagram_contato",
              "value": "788726"
            },
            {
              "name": "nome_contato",
              "value": "11743307"
            },
            {
              "name": "telefone_contato",
              "value": "710450"
            },
            {
              "name": "email_contato",
              "value": "710452"
            },
            {
              "name": "utm_source_contato",
              "value": "1015234"
            },
            {
              "name": "utm_campaign_contato",
              "value": "1015236"
            },
            {
              "name": "utm_content_contato",
              "value": "1015238"
            },
            {
              "name": "utm_medium_contato",
              "value": "1015240"
            },
            {
              "name": "utm_term_contato",
              "value": "1015242"
            },
            {
              "name": "utm_fun_contato",
              "value": "1015244"
            },
            {
              "name": "utm_var_contato",
              "value": "1015246"
            },
            {
              "name": "instagram_lead",
              "value": "1018510"
            },
            {
              "name": "utm_source_lead",
              "value": "1018512"
            },
            {
              "name": "utm_campaign_lead",
              "value": "1018514"
            },
            {
              "name": "utm_content_lead",
              "value": "1008412"
            },
            {
              "name": "utm_medium_lead",
              "value": "1018516"
            },
            {
              "name": "utm_term_lead",
              "value": "1018518"
            },
            {
              "name": "utm_fun_lead",
              "value": "1018520"
            },
            {
              "name": "utm_var_lead",
              "value": "1018522"
            },
            {
              "name": "url_base",
              "value": "https://evolutionapi.automagicbots.com.br"
            },
            {
              "name": "apikey",
              "value": "1gozy92fyg3hlty3wkv7f"
            },
            {
              "name": "nome_da_instancia",
              "value": "MSAHenrySantos"
            }
          ]
        },
        "options": {}
      },
      "id": "6d1f2313-8ed4-47b3-90cc-5dfccfd47161",
      "name": "dados_validados1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        860,
        620
      ]
    },
    {
      "parameters": {
        "queue": "Webnario - Parte 2",
        "options": {
          "arguments": {
            "argument": [
              {
                "key": "x-queue-type",
                "value": "quorum"
              }
            ]
          },
          "durable": true
        }
      },
      "id": "249947ab-1071-48e6-85e4-47ba6fd0d84a",
      "name": "entra_na_fila1",
      "type": "n8n-nodes-base.rabbitmq",
      "typeVersion": 1,
      "position": [
        1040,
        620
      ],
      "credentials": {
        "rabbitmq": {
          "id": "J2XRJ2ukEbkqQASv",
          "name": "[RabbitMQ] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "id_sdr",
              "stringValue": "={{ $node[\"pesquisa_colaborador\"].json[\"id_vez\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "574ecd8e-6515-439e-a776-14edd0df4bab",
      "name": "id_sdr_rodizio1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        480,
        620
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "colaboradores",
          "mode": "list",
          "cachedResultName": "colaboradores"
        },
        "where": {
          "values": [
            {
              "column": "email",
              "value": "vitorrqueiroztrafego@gmail.com"
            }
          ]
        },
        "options": {}
      },
      "id": "433d152d-40f6-45db-817e-1baeef19d89a",
      "name": "pesquisa_colaborador",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -340,
        620
      ],
      "credentials": {
        "mySql": {
          "id": "rva8krZgONj5RBij",
          "name": "[MySQL] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "colaboradores",
          "mode": "list",
          "cachedResultName": "colaboradores"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "email",
        "valueToMatchOn": "vitorrqueiroztrafego@gmail.com",
        "valuesToSend": {
          "values": [
            {
              "column": "id_vez",
              "value": "Jean"
            }
          ]
        },
        "options": {}
      },
      "id": "fc13ca76-66de-43a0-9849-b93aaea3e365",
      "name": "atualiza_vez_closer",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        300,
        780
      ],
      "credentials": {
        "mySql": {
          "id": "rva8krZgONj5RBij",
          "name": "[MySQL] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "552b2396-434c-42b6-99c4-0f6c5de72b7e",
              "leftValue": "={{ $json[\"id_vez\"] }}",
              "rightValue": "Jean",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "50db53a7-da13-41fb-af4a-72e8f3593c71",
      "name": "verifica_closer2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -120,
        620
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "colaboradores",
          "mode": "list",
          "cachedResultName": "colaboradores"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "email",
        "valueToMatchOn": "vitorrqueiroztrafego@gmail.com",
        "valuesToSend": {
          "values": [
            {
              "column": "id_vez",
              "value": "Will"
            }
          ]
        },
        "options": {}
      },
      "id": "ce83fb0d-f13a-4b35-8ee5-d3d226837fa2",
      "name": "atualiza_vez_closer3",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        80,
        620
      ],
      "credentials": {
        "mySql": {
          "id": "rva8krZgONj5RBij",
          "name": "[MySQL] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a33d7185-fd20-49b8-b8e4-d6c884085b27",
              "leftValue": "={{ $json[\"id_vez\"] }}",
              "rightValue": "Will",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ed8aad4d-a888-4cdd-b0d4-6147ea550d2e",
      "name": "verifica_closer3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        120,
        780
      ]
    },
    {
      "parameters": {},
      "id": "9762d155-66e5-4571-a666-f44d8c3acd5e",
      "name": "No Operation, do nothing1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        660,
        620
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sala-secreta-captacao-manychat",
        "options": {}
      },
      "id": "06b779d2-35b9-4c28-90d0-d2eab96c85b3",
      "name": "sala_secreta_manychat",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [
        -720,
        620
      ],
      "webhookId": "a0979ad2-d086-4c27-8eb3-411eca1a59c7"
    }
  ],
  "pinData": {
    "sala_secreta": [
      {
        "json": {
          "headers": {
            "host": "webhookhetznerhenrysantos.automagicbots.com.br",
            "user-agent": "WordPress/6.6.1; https://salaolucrativo.gestaodesaloes.com.br",
            "content-length": "267",
            "accept": "*/*",
            "accept-encoding": "deflate, gzip, br",
            "content-type": "application/x-www-form-urlencoded",
            "x-forwarded-for": "35.233.91.21",
            "x-forwarded-host": "webhookhetznerhenrysantos.automagicbots.com.br",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "b71525949d32",
            "x-real-ip": "35.233.91.21"
          },
          "params": {},
          "query": {},
          "body": {
            "Nome": "Vitor queiroz de almeida",
            "Whatsapp": "(19) 98457-4874",
            "E-mail": "vitorrqueiroztrafego@gmail.com",
            "Instagram": "@eu.queirozads",
            "utm_source": "source1",
            "utm_campaign": "campaign2",
            "utm_medium": "medium4",
            "utm_content": "content3",
            "utm_term": "term5",
            "form_id": "f094bfc",
            "form_name": "FORMS IMERS√ÉO"
          }
        }
      }
    ],
    "sala_secreta_manychat": [
      {
        "json": {
          "headers": {
            "host": "webhookhetznerhenrysantos.automagicbots.com.br",
            "user-agent": "ManyChat",
            "content-length": "143",
            "content-type": "application/json; charset=utf-8",
            "x-forwarded-for": "3.73.48.89",
            "x-forwarded-host": "webhookhetznerhenrysantos.automagicbots.com.br",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "b71525949d32",
            "x-real-ip": "3.73.48.89",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "Nome": "Almeida Vitor",
            "Telefone": "+19984574874",
            "Origem": "manychat",
            "Fluxo": "Sala Secreta",
            "Instagram": "eu.vitorqueiroz"
          }
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "YqwIRpfotJoCTvFh"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-02-01T18:54:52.902Z",
  "versionId": "21b66d2f-ab11-40a8-a8b5-a147d4d19535"
}