{
  "active": false,
  "connections": {
    "le_planilha1": {
      "main": [
        [
          {
            "node": "separa_em_linhas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verifica_data1": {
      "main": [
        [
          {
            "node": "excluir_lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking \"Test workflow\"": {
      "main": [
        [
          {
            "node": "verifica_data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retorna Output Aleatorio": {
      "main": [
        [
          {
            "node": "Saida Aleatoria",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saida Aleatoria": {
      "main": [
        [
          {
            "node": "40s",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "45s",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "50s",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "53s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "40s": {
      "main": [
        [
          {
            "node": "separa_em_linhas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "45s": {
      "main": [
        [
          {
            "node": "separa_em_linhas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "50s": {
      "main": [
        [
          {
            "node": "separa_em_linhas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "53s": {
      "main": [
        [
          {
            "node": "separa_em_linhas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_em_linhas1": {
      "main": [
        [
          {
            "node": "Item Lists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "EnviaMensagemTexto5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "separa_em_linhas": {
      "main": [
        [
          {
            "node": "Item Lists2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "puxa_lista": {
      "main": [
        [
          {
            "node": "separa_em_linhas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "insere_telefone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "insere_telefone": {
      "main": [
        [
          {
            "node": "separa_em_linhas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "atualiza_status": {
      "main": [
        [
          {
            "node": "Retorna Output Aleatorio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviaMensagemTexto5": {
      "main": [
        [
          {
            "node": "atualiza_status",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "separa_em_linhas1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item Lists2": {
      "main": [
        [
          {
            "node": "puxa_lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item Lists": {
      "main": [
        [
          {
            "node": "EnviaMensagemTexto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excluir_lista": {
      "main": [
        [
          {
            "node": "le_planilha1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-09-26T19:37:25.506Z",
  "id": "1sTVvnptA9DHvKr5",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "üöÄ[EVOLUTION] - Disparo em Massa P/ Follow-Up Kommo",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.automagicbots.com.br/message/sendText/HenrySantos",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "jsvhasy6ni20702nrvluf"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=5562981196678"
            },
            {
              "name": "textMessage.text",
              "value": "=Disparo em massa do Henry Santos finalizado. üöÄ"
            },
            {
              "name": "options.delay",
              "value": "={{ 1200 }}"
            },
            {
              "name": "options.presence",
              "value": "composing"
            },
            {
              "name": "options.linkPreview",
              "value": "={{ true }}"
            },
            {
              "name": "=options.mentions.everyOne",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true
            }
          }
        }
      },
      "id": "11c48c6b-936e-437e-a881-0748be14b101",
      "name": "EnviaMensagemTexto1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        560,
        -360
      ],
      "typeVersion": 4
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1nAFIXlkiH4yGxM708uwvxdz5Lxrr3E-i5NTu9i-3o_E",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 2084102440,
          "mode": "list",
          "cachedResultName": "Henry - 26/09",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1nAFIXlkiH4yGxM708uwvxdz5Lxrr3E-i5NTu9i-3o_E/edit#gid=2084102440"
        },
        "options": {}
      },
      "id": "f6b1c6df-fce3-4d11-bcad-f3235429168c",
      "name": "le_planilha1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [
        -660,
        -240
      ],
      "retryOnFail": true,
      "maxTries": 5,
      "waitBetweenTries": 5000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "mv05vcFs4fQSWBmO",
          "name": "[Google Sheets] - Automagic Bots"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "6e0dc768-c500-4f44-afeb-462ab225bf6a",
              "leftValue": "={{ $now.toFormat('dd/MM/yyyy') }}",
              "rightValue": "26/09/2024",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "f176911b-7305-4010-8bf1-079fb2052e37",
      "name": "verifica_data1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1060,
        -220
      ]
    },
    {
      "parameters": {},
      "id": "610f3378-a2af-46ec-8c48-9f18c98951a3",
      "name": "When clicking \"Test workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1220,
        -220
      ]
    },
    {
      "parameters": {
        "operation": "limit",
        "keep": "lastItems"
      },
      "id": "4cdbca17-4664-4350-aaa4-e3634a1a887f",
      "name": "Item Lists",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        380,
        -360
      ]
    },
    {
      "parameters": {
        "jsCode": "return {aleatorio: Math.floor(Math.random() * 4)};"
      },
      "id": "3f985a8d-d4c9-4805-92c0-d3d5d4cd4e1a",
      "name": "Retorna Output Aleatorio",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        760,
        -180
      ]
    },
    {
      "parameters": {
        "value1": "={{ $json[\"aleatorio\"] }}",
        "rules": {
          "rules": [
            {
              "operation": "equal"
            },
            {
              "operation": "equal",
              "value2": 1,
              "output": 1
            },
            {
              "operation": "equal",
              "value2": 2,
              "output": 2
            }
          ]
        },
        "fallbackOutput": 3
      },
      "id": "1c65102a-69e4-403f-909d-24f70ef6aefc",
      "name": "Saida Aleatoria",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [
        940,
        -180
      ]
    },
    {
      "parameters": {
        "amount": 40,
        "unit": "seconds"
      },
      "id": "325ef875-4911-4549-9c09-a6e0a1e27f43",
      "name": "40s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        1260,
        -200
      ],
      "webhookId": "608f66f4-b785-4486-936e-68b6a908fffb"
    },
    {
      "parameters": {
        "amount": 45,
        "unit": "seconds"
      },
      "id": "9f2429fc-fa19-47a2-a7ab-cfb9ddf45d92",
      "name": "45s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        1260,
        -60
      ],
      "webhookId": "765efa86-23b2-4e9a-b7f1-4de919607b36"
    },
    {
      "parameters": {
        "amount": 50,
        "unit": "seconds"
      },
      "id": "0553bb3a-afb0-438d-9686-f02be4477125",
      "name": "50s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        1260,
        80
      ],
      "webhookId": "f5b69a57-2354-4524-ae18-a889c2457a7c"
    },
    {
      "parameters": {
        "amount": 53,
        "unit": "seconds"
      },
      "id": "614890e5-2a3f-4067-84b0-b31581b8e065",
      "name": "53s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        1260,
        220
      ],
      "webhookId": "eb33aaee-0102-4c57-8d14-dc964e8a2524"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "9f451ca5-fde6-4d11-9a65-7f7d4725e228",
      "name": "separa_em_linhas1",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        160,
        -260
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "ac6af61f-c92f-4a25-8ee8-7b2bdc6a2b5d",
      "name": "separa_em_linhas",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -480,
        -240
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "disparos_em_massa",
          "mode": "list",
          "cachedResultName": "disparos_em_massa"
        },
        "options": {}
      },
      "id": "863b2747-897f-4aca-9d81-898df56691a1",
      "name": "puxa_lista",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -60,
        -340
      ],
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obt√©m os contatos do campo \"Contatos\"\nconst contatos = $node[\"separa_em_linhas\"].json[\"telefone\"].toString();\n\n// Divide o campo \"Contatos\" em partes com base no espa√ßo entre o e-mail e o telefone\nconst partesContatos = contatos.split(\" \");\n\n// Encontra a √∫ltima parte que ser√° o telefone\nconst telefoneOriginal = partesContatos[partesContatos.length - 1];\n\n// Removendo caracteres n√£o num√©ricos do telefone\nconst telefoneLimpo = telefoneOriginal.replace(/\\D/g, '');\n\n// Define o DDI e DDD padr√£o\nconst ddiPadrao = '55';\nconst dddPadrao = '48';\n\n// Verifica o comprimento do telefone e ajusta DDI e DDD se necess√°rio\nlet telefoneFinal;\nif (telefoneLimpo.length === 8) {\n    // Telefone sem DDD e sem DDI, adiciona ambos\n    telefoneFinal = ddiPadrao + dddPadrao + telefoneLimpo;\n} else if (telefoneLimpo.length === 9) {\n    // Telefone sem DDD, adiciona apenas DDD\n    telefoneFinal = ddiPadrao + dddPadrao + telefoneLimpo;\n} else if (telefoneLimpo.length === 10) {\n    // Telefone com DDD, sem DDI\n    telefoneFinal = ddiPadrao + telefoneLimpo;\n} else if (telefoneLimpo.length === 11 && !telefoneLimpo.startsWith(ddiPadrao)) {\n    // Telefone com DDD e sem DDI, adiciona o DDI\n    telefoneFinal = ddiPadrao + telefoneLimpo;\n} else if (telefoneLimpo.length === 12 && telefoneLimpo.startsWith(ddiPadrao)) {\n    // Telefone j√° tem DDI e DDD\n    telefoneFinal = telefoneLimpo;\n} else {\n    // Caso o n√∫mero n√£o caia em nenhuma das categorias, retorna o telefone como est√°\n    telefoneFinal = telefoneLimpo;\n}\n\nreturn { telefonefinal: telefoneFinal };\n"
      },
      "id": "00960a64-f1d6-414b-b680-e368497a3cb6",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -320,
        -160
      ]
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "disparos_em_massa",
          "mode": "list",
          "cachedResultName": "disparos_em_massa"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "telefone",
              "value": "={{ $json[\"telefonefinal\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8bb942eb-1008-4721-92a5-06309282a90c",
      "name": "insere_telefone",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -160,
        -160
      ],
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "disparos_em_massa",
          "mode": "list",
          "cachedResultName": "disparos_em_massa"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "telefone",
        "valueToMatchOn": "={{ $node[\"separa_em_linhas1\"].json[\"telefone\"] }}",
        "valuesToSend": {
          "values": [
            {
              "column": "status",
              "value": "enviado"
            }
          ]
        },
        "options": {}
      },
      "id": "2c1f5e03-f05f-44a8-840f-e91990de242f",
      "name": "atualiza_status",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        560,
        -180
      ],
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://evolutionapi.automagicbots.com.br/message/sendText/HenrySantos",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "jsvhasy6ni20702nrvluf"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $node[\"separa_em_linhas1\"].json[\"telefone\"] }}"
            },
            {
              "name": "textMessage.text",
              "value": "=üö®Boa Not√≠cia üö®\n\nOlha s√≥, o Henry quer te conhecer e, por isso, vai realizar uma sala exclusiva no Zoom hoje √†s 19h, pra voc√™ ter a experi√™ncia que nossos alunos t√™m na mentoria, podendo tirar todas d√∫vidas sobre a gest√£o do seu sal√£o. Estou te convidando para participar dessa oportunidade √∫nica, esta sala n√£o ser√° divulgada em nossas redes sociais, justamente para manter a exclusividade. O que acha, voc√™ topa¬†participar?"
            },
            {
              "name": "options.delay",
              "value": "={{ 1200 }}"
            },
            {
              "name": "options.presence",
              "value": "composing"
            },
            {
              "name": "options.linkPreview",
              "value": "={{ true }}"
            },
            {
              "name": "=options.mentions.everyOne",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "neverError": true
            }
          }
        }
      },
      "id": "d72b3ace-84de-4e9d-926c-fd43224530b3",
      "name": "EnviaMensagemTexto5",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        380,
        -180
      ],
      "typeVersion": 4,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "limit"
      },
      "id": "ce8cecfa-9724-4d6d-abb9-895967848cd1",
      "name": "Item Lists2",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        -220,
        -340
      ]
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "table": {
          "__rl": true,
          "value": "disparos_em_massa",
          "mode": "list",
          "cachedResultName": "disparos_em_massa"
        },
        "options": {}
      },
      "id": "be6cad1c-897e-453d-a58f-411e5df89a22",
      "name": "excluir_lista",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.2,
      "position": [
        -820,
        -240
      ],
      "credentials": {
        "mySql": {
          "id": "gBeJmlfVOrdUXALL",
          "name": "[MySQL][2.0] - Henry Santos"
        }
      }
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "9WrqNFN2jagHPbWV"
  },
  "staticData": {
    "node:dispara as 12hs1": {
      "recurrencyRules": []
    },
    "node:dispara as 12hs": {
      "recurrencyRules": []
    },
    "node:dispara as 17hs": {
      "recurrencyRules": []
    },
    "node:dispara as 17hs1": {
      "recurrencyRules": []
    },
    "node:13h": {
      "recurrencyRules": []
    },
    "node:9hs": {
      "recurrencyRules": []
    },
    "node:13hs": {
      "recurrencyRules": []
    },
    "node:23hs": {
      "recurrencyRules": []
    },
    "node:20hs": {
      "recurrencyRules": []
    },
    "node:12hs": {
      "recurrencyRules": []
    },
    "node:15hs": {
      "recurrencyRules": []
    },
    "node:15hs1": {
      "recurrencyRules": []
    },
    "node:8hs": {
      "recurrencyRules": []
    }
  },
  "tags": [],
  "triggerCount": 3,
  "updatedAt": "2024-09-26T19:55:02.763Z",
  "versionId": "06582e77-3659-4906-a9d7-838d6a707a0e"
}